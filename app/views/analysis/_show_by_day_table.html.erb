<table class="table ui">
  <thead>
    <tr>
      <th>日付</th>
      <th class="right aligned">発電量(kwh)</th>
      <th class="right aligned">近隣日射量(MJ/m2)</th>
    </tr>
  </thead>
  <tbody>
    <% @records.each do |record| %>
      <tr>
        <td><%= record.date.day %>日</td>
        <td class="right aligned">
          <%= 
            if record.kwh
              ((record.kwh || 0) + @correction_value)&.to_i&.to_s(:delimited)
            else
              "予測値: #{(record.estimate_kwh + @correction_value).to_i.to_s(:delimited)}"
            end
          %>
          <% if @correction_value != 0 %>
            (含補正値: <%= '+' if @correction_value > 0 %><%= @correction_value.to_i&.to_s(:delimited) %>)
          <% end  %>
        </td>
        <td class="right aligned"><%= record.solar_radiation %></td>
      </tr>
    <% end %>
  </tbody>
  <tfoot>
    <% record_kwh = @records.map{|r| r.kwh || r.estimate_kwh }.compact %>
    <% sum_kwh = record_kwh.sum %>
    <% sum_correction_value = @correction_value_sum %>
    <tr class="warning">
      <td>合計</td>
      <td class="right aligned">
        <% if @records.present? %>
          <%= (sum_kwh + sum_correction_value).to_i.to_s(:delimited) %>
          <% if sum_correction_value != 0 %>
            (含補正値: <%= '+' if sum_correction_value > 0 %><%= sum_correction_value.to_i&.to_s(:delimited) %>)
          <% end  %>
        <% end  %>
      </td>
      <td class="right aligned"><%= @records.map(&:solar_radiation).compact.sum %></td>
    </tr>
    <tr class="warning">
      <td>平均</td>
      <td class="right aligned"><%= ((sum_kwh + sum_correction_value).to_f / @records.size).to_i.to_s(:delimited)  if @records.present? %></td>
      <td class="right aligned"><%= (@records.map(&:solar_radiation).compact.sum / @records.size).round(2) if @records.present? %></td>
    </tr>
    <tr class="warning">
      <td>最小値</td>
      <td class="right aligned"><%= (record_kwh.min + @correction_value).to_i.to_s(:delimited) if @records.present? %></td>
      <td class="right aligned"><%= @records.map(&:solar_radiation).compact.min if @records.present? %></td>
    </tr>
    <tr class="warning">
      <td>最大値</td>
      <td class="right aligned"><%= (record_kwh.max + @correction_value).to_i.to_s(:delimited) if @records.present? %></td>
      <td class="right aligned"><%= @records.map(&:solar_radiation).compact.max if @records.present? %></td>
    </tr>
  </tfoot>
</table>
